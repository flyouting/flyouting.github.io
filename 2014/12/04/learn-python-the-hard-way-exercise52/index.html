<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>笨办法学Python--exercise52.开始你的web游戏 | flyouting and shirley</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="这本书马上就要结束了。本章的练习对你是一个真正的挑战。当你完成以后，你就可以算是一个能力不错的Python初学者了。为了进一步学习，你还需要多读一些书，多写一些程序，不过你已经具备进一步学习的技能了。接下来的学习就只是时间、动力、以及资源的问题了。
在本章习题中，我们不会去创建一个完整的游戏，取而代之的是我们会为《习题 47》中的游戏创建一个“引擎(engine)”，让这个游戏能够在浏览器中运行起">
<meta property="og:type" content="article">
<meta property="og:title" content="笨办法学Python--exercise52.开始你的web游戏">
<meta property="og:url" content="http://coofee.me/2014/12/04/learn-python-the-hard-way-exercise52/index.html">
<meta property="og:site_name" content="flyouting and shirley">
<meta property="og:description" content="这本书马上就要结束了。本章的练习对你是一个真正的挑战。当你完成以后，你就可以算是一个能力不错的Python初学者了。为了进一步学习，你还需要多读一些书，多写一些程序，不过你已经具备进一步学习的技能了。接下来的学习就只是时间、动力、以及资源的问题了。
在本章习题中，我们不会去创建一个完整的游戏，取而代之的是我们会为《习题 47》中的游戏创建一个“引擎(engine)”，让这个游戏能够在浏览器中运行起">
<meta property="og:updated_time" content="2014-12-07T15:21:48.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="笨办法学Python--exercise52.开始你的web游戏">
<meta name="twitter:description" content="这本书马上就要结束了。本章的练习对你是一个真正的挑战。当你完成以后，你就可以算是一个能力不错的Python初学者了。为了进一步学习，你还需要多读一些书，多写一些程序，不过你已经具备进一步学习的技能了。接下来的学习就只是时间、动力、以及资源的问题了。
在本章习题中，我们不会去创建一个完整的游戏，取而代之的是我们会为《习题 47》中的游戏创建一个“引擎(engine)”，让这个游戏能够在浏览器中运行起">
  
    <link rel="alternative" href="/atom.xml" title="flyouting and shirley" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ww2.sinaimg.cn/small/4a242739gw1eu09kkcr5xj2050050glt.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">flyouting and shirley</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记录一点一滴</p>
		

		<!--
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>About</li>
						
					</ul>
				</div>
			</div>
		-->

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">首页</a></li>
				        
							<li><a href="/archives">文章列表</a></li>
				        
							<li><a href="/about">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/flyouting" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/flyouting" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/flyouting" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:flyouting@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				<div class="switch-part switch-part2"><script>var n ='b-26003349-pe-f-801';var ch ='pc_6'; var w1 = 200;var h1 = 280;</script> <script src='http://static.luna.58.com/js/mad.js'></script></div>
				
				<!--
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AndroidStudio/" style="font-size: 10px;">AndroidStudio</a> <a href="/tags/DB/" style="font-size: 12.5px;">DB</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/ImageSpan/" style="font-size: 10px;">ImageSpan</a> <a href="/tags/ORM/" style="font-size: 12.5px;">ORM</a> <a href="/tags/Python/" style="font-size: 12.5px;">Python</a> <a href="/tags/activeandroid/" style="font-size: 10px;">activeandroid</a> <a href="/tags/android/" style="font-size: 17.5px;">android</a> <a href="/tags/intent/" style="font-size: 10px;">intent</a> <a href="/tags/key/" style="font-size: 10px;">key</a> <a href="/tags/layout/" style="font-size: 10px;">layout</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/span/" style="font-size: 10px;">span</a> <a href="/tags/transitions/" style="font-size: 10px;">transitions</a> <a href="/tags/volley/" style="font-size: 15px;">volley</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/后台，多线程/" style="font-size: 10px;">后台，多线程</a> <a href="/tags/相机/" style="font-size: 15px;">相机</a> <a href="/tags/终端/" style="font-size: 10px;">终端</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
					</div>
				</section>
				-->
				
				<!--
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				-->
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">flyouting and shirley</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://ww2.sinaimg.cn/small/4a242739gw1eu09kkcr5xj2050050glt.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">flyouting and shirley</h1>
			</hgroup>
			
			<p class="header-subtitle">记录一点一滴</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">首页</a></li>
		        
					<li><a href="/archives">文章列表</a></li>
		        
					<li><a href="/about">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/flyouting" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/flyouting" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/flyouting" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:flyouting@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-learn-python-the-hard-way-exercise52" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/12/04/learn-python-the-hard-way-exercise52/" class="article-date">
  	<time datetime="2014-12-04T13:43:57.000Z" itemprop="datePublished">2014-12-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      笨办法学Python--exercise52.开始你的web游戏
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Python/">Python</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>这本书马上就要结束了。本章的练习对你是一个真正的挑战。当你完成以后，你就可以算是一个能力不错的Python初学者了。为了进一步学习，你还需要多读一些书，多写一些程序，不过你已经具备进一步学习的技能了。接下来的学习就只是时间、动力、以及资源的问题了。</p>
<p>在本章习题中，我们不会去创建一个完整的游戏，取而代之的是我们会为《习题 47》中的游戏创建一个“引擎(engine)”，让这个游戏能够在浏览器中运行起来。这会涉及到将《习题 43》中的游戏“重构(refactor)”，将《习题 47》中的架构混合进来，添加自动测试代码，最后创建一个可以运行游戏的 web 引擎。</p>
<p>这是一节很庞大的习题。我预测你要花一周到一个月才能完成它。最好的方法是一点点来，每天晚上完成一点，在进行下一步之前确认上一步有正确完成。</p>
<h2 id="重构习题43的游戏"><a href="#重构习题43的游戏" class="headerlink" title="重构习题43的游戏"></a>重构习题43的游戏</h2><p>你已经在两个练习中修改了<code>gothonweb</code>项目，这节习题中你会再修改一次。这种修改的技术叫做“重构(refactoring)”，或者用我喜欢的讲法来说，叫“修修补补(fixing stuff)”。重构是一个编程术语，它指的是清理旧代码或者为旧代码添加新功能的过程。你其实已经做过这样的事情了，只不过不知道这个术语而已。这是写软件过程的第二个自然属性。</p>
<p>你在本节中要做的，是将《习题 47》中的可以测试的房间地图，以及《习题 43》中的游戏这两样东西归并到一起，创建一个新的游戏架构。游戏的内容不会变化，只不过我们会通过“重构”让它有一个更好的架构而已。</p>
<p>第一步是将<code>ex47/game.py</code>的内容复制到<code>gothonweb/map.py</code>中，然后将 <code>tests/ex47_tests.py</code>的内容复制到<code>tests/map_tests.py</code>中，然后再次运行 <code>nosetests</code>，确认他们还能正常工作。</p>
<blockquote>
<p><strong>NOTE:</strong><br>从现在开始我不会再向你展示运行测试的输出了，我就假设你回去运行这些测试，而且知道怎样的输出是正确的。</p>
</blockquote>
<p>将《习题 47》的代码拷贝完毕后，你就该开始重构它，让它包含《习题43》中的地图。我一开始会把基本架构为你准备好，然后你需要去完成<code>map.py</code> 和<code>map_tests.py</code>里边的内容。</p>
<p>首先要做的是使用<code>Room</code>类来构建基本的地图架构：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, description)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.description = description</span><br><span class="line">        self.paths = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">go</span><span class="params">(self, direction)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.paths.get(direction, <span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add_paths</span><span class="params">(self, paths)</span>:</span></span><br><span class="line">        self.paths.update(paths)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">central_corridor = Room(<span class="string">"Central Corridor"</span>,</span><br><span class="line"><span class="string">"""</span><br><span class="line">The Gothons of Planet Percal #25 have invaded your ship and destroyed</span><br><span class="line">your entire crew.  You are the last surviving member and your last</span><br><span class="line">mission is to get the neutron destruct bomb from the Weapons Armory,</span><br><span class="line">put it in the bridge, and blow the ship up after getting into an </span><br><span class="line">escape pod.</span><br><span class="line"></span><br><span class="line">You're running down the central corridor to the Weapons Armory when</span><br><span class="line">a Gothon jumps out, red scaly skin, dark grimy teeth, and evil clown costume</span><br><span class="line">flowing around his hate filled body.  He's blocking the door to the</span><br><span class="line">Armory and about to pull a weapon to blast you.</span><br><span class="line">"""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">laser_weapon_armory = Room(<span class="string">"Laser Weapon Armory"</span>,</span><br><span class="line"><span class="string">"""</span><br><span class="line">Lucky for you they made you learn Gothon insults in the academy.</span><br><span class="line">You tell the one Gothon joke you know:</span><br><span class="line">Lbhe zbgure vf fb sng, jura fur fvgf nebhaq gur ubhfr, fur fvgf nebhaq gur ubhfr.</span><br><span class="line">The Gothon stops, tries not to laugh, then busts out laughing and can't move.</span><br><span class="line">While he's laughing you run up and shoot him square in the head</span><br><span class="line">putting him down, then jump through the Weapon Armory door.</span><br><span class="line"></span><br><span class="line">You do a dive roll into the Weapon Armory, crouch and scan the room</span><br><span class="line">for more Gothons that might be hiding.  It's dead quiet, too quiet.</span><br><span class="line">You stand up and run to the far side of the room and find the</span><br><span class="line">neutron bomb in its container.  There's a keypad lock on the box</span><br><span class="line">and you need the code to get the bomb out.  If you get the code</span><br><span class="line">wrong 10 times then the lock closes forever and you can't</span><br><span class="line">get the bomb.  The code is 3 digits.</span><br><span class="line">"""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">the_bridge = Room(<span class="string">"The Bridge"</span>,</span><br><span class="line"><span class="string">"""</span><br><span class="line">The container clicks open and the seal breaks, letting gas out.</span><br><span class="line">You grab the neutron bomb and run as fast as you can to the</span><br><span class="line">bridge where you must place it in the right spot.</span><br><span class="line"></span><br><span class="line">You burst onto the Bridge with the netron destruct bomb</span><br><span class="line">under your arm and surprise 5 Gothons who are trying to</span><br><span class="line">take control of the ship.  Each of them has an even uglier</span><br><span class="line">clown costume than the last.  They haven't pulled their</span><br><span class="line">weapons out yet, as they see the active bomb under your</span><br><span class="line">arm and don't want to set it off.</span><br><span class="line">"""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">escape_pod = Room(<span class="string">"Escape Pod"</span>,</span><br><span class="line"><span class="string">"""</span><br><span class="line">You point your blaster at the bomb under your arm</span><br><span class="line">and the Gothons put their hands up and start to sweat.</span><br><span class="line">You inch backward to the door, open it, and then carefully</span><br><span class="line">place the bomb on the floor, pointing your blaster at it.</span><br><span class="line">You then jump back through the door, punch the close button</span><br><span class="line">and blast the lock so the Gothons can't get out.</span><br><span class="line">Now that the bomb is placed you run to the escape pod to</span><br><span class="line">get off this tin can.</span><br><span class="line"></span><br><span class="line">You rush through the ship desperately trying to make it to</span><br><span class="line">the escape pod before the whole ship explodes.  It seems like</span><br><span class="line">hardly any Gothons are on the ship, so your run is clear of</span><br><span class="line">interference.  You get to the chamber with the escape pods, and</span><br><span class="line">now need to pick one to take.  Some of them could be damaged</span><br><span class="line">but you don't have time to look.  There's 5 pods, which one</span><br><span class="line">do you take?</span><br><span class="line">"""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">the_end_winner = Room(<span class="string">"The End"</span>,</span><br><span class="line"><span class="string">"""</span><br><span class="line">You jump into pod 2 and hit the eject button.</span><br><span class="line">The pod easily slides out into space heading to</span><br><span class="line">the planet below.  As it flies to the planet, you look</span><br><span class="line">back and see your ship implode then explode like a</span><br><span class="line">bright star, taking out the Gothon ship at the same</span><br><span class="line">time.  You won!</span><br><span class="line">"""</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">the_end_loser = Room(<span class="string">"The End"</span>,</span><br><span class="line"><span class="string">"""</span><br><span class="line">You jump into a random pod and hit the eject button.</span><br><span class="line">The pod escapes out into the void of space, then</span><br><span class="line">implodes as the hull ruptures, crushing your body</span><br><span class="line">into jam jelly.</span><br><span class="line">"""</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">escape_pod.add_paths(&#123;</span><br><span class="line">    <span class="string">'2'</span>: the_end_winner,</span><br><span class="line">    <span class="string">'*'</span>: the_end_loser</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">generic_death = Room(<span class="string">"death"</span>, <span class="string">"You died."</span>)</span><br><span class="line"></span><br><span class="line">the_bridge.add_paths(&#123;</span><br><span class="line">    <span class="string">'throw the bomb'</span>: generic_death,</span><br><span class="line">    <span class="string">'slowly place the bomb'</span>: escape_pod</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">laser_weapon_armory.add_paths(&#123;</span><br><span class="line">    <span class="string">'0132'</span>: the_bridge,</span><br><span class="line">    <span class="string">'*'</span>: generic_death</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">central_corridor.add_paths(&#123;</span><br><span class="line">    <span class="string">'shoot!'</span>: generic_death,</span><br><span class="line">    <span class="string">'dodge!'</span>: generic_death,</span><br><span class="line">    <span class="string">'tell a joke'</span>: laser_weapon_armory</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">START = central_corridor</span><br></pre></td></tr></table></figure>
<p>你会发现我们的<code>Room</code>类和地图有一些问题：</p>
<blockquote>
<ol>
<li>在进入一个房间以前会打印出一段文字作为房间的描述，我们需要将这些描述和每个房间关联起来，这样房间的次序就不会被打乱了，这对我们的游戏是一件好事。这些描述本来是在<code>if-else</code>结构中的，这是我们后面要修改的东西。</li>
<li>原版游戏中我们使用了专门的代码来生成一些内容，例如炸弹的激活键码，舰舱的选择等，这次我们做游戏时就先使用默认值好了，不过后面的附加题里，我会要求你把这些功能再加到游戏中。</li>
<li>我为所有的游戏中的失败结尾写了一个<code>generic_death</code>，你需要去补全这个函数。你需要把原版游戏中所有的失败结尾都加进去，并确保代码能正确运行。</li>
<li>我添加了一种新的转换模式，以”*”为标记，用来在游戏引擎中实现“catch-all”动作。</li>
</ol>
</blockquote>
<p>等你把上面的代码基本写好以后，接下来就是引导你继续写下去的自动测试的内容<code>tests/map_test.py</code>了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nose.tools <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gothonweb.map <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_room</span><span class="params">()</span>:</span></span><br><span class="line">    gold = Room(<span class="string">"GoldRoom"</span>,</span><br><span class="line">                <span class="string">"""This room has gold in it you can grab. There's a</span><br><span class="line">                door to the north."""</span>)</span><br><span class="line">    assert_equal(gold.name, <span class="string">"GoldRoom"</span>)</span><br><span class="line">    assert_equal(gold.paths, &#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_room_paths</span><span class="params">()</span>:</span></span><br><span class="line">    center = Room(<span class="string">"Center"</span>, <span class="string">"Test room in the center."</span>)</span><br><span class="line">    north = Room(<span class="string">"North"</span>, <span class="string">"Test room in the north."</span>)</span><br><span class="line">    south = Room(<span class="string">"South"</span>, <span class="string">"Test room in the south."</span>)</span><br><span class="line"></span><br><span class="line">    center.add_paths(&#123;<span class="string">'north'</span>: north, <span class="string">'south'</span>: south&#125;)</span><br><span class="line">    assert_equal(center.go(<span class="string">'north'</span>), north)</span><br><span class="line">    assert_equal(center.go(<span class="string">'south'</span>), south)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_map</span><span class="params">()</span>:</span></span><br><span class="line">    start = Room(<span class="string">"Start"</span>, <span class="string">"You can go west and down a hole."</span>)</span><br><span class="line">    west = Room(<span class="string">"Trees"</span>, <span class="string">"There are trees here, you can go east."</span>)</span><br><span class="line">    down = Room(<span class="string">"Dungeon"</span>, <span class="string">"It's dark down here, you can go up."</span>)</span><br><span class="line"></span><br><span class="line">    start.add_paths(&#123;<span class="string">'west'</span>: west, <span class="string">'down'</span>: down&#125;)</span><br><span class="line">    west.add_paths(&#123;<span class="string">'east'</span>: start&#125;)</span><br><span class="line">    down.add_paths(&#123;<span class="string">'up'</span>: start&#125;)</span><br><span class="line"></span><br><span class="line">    assert_equal(start.go(<span class="string">'west'</span>), west)</span><br><span class="line">    assert_equal(start.go(<span class="string">'west'</span>).go(<span class="string">'east'</span>), start)</span><br><span class="line">    assert_equal(start.go(<span class="string">'down'</span>).go(<span class="string">'up'</span>), start)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_gothon_game_map</span><span class="params">()</span>:</span></span><br><span class="line">    assert_equal(START.go(<span class="string">'shoot!'</span>), generic_death)</span><br><span class="line">    assert_equal(START.go(<span class="string">'dodge!'</span>), generic_death)</span><br><span class="line"></span><br><span class="line">    room = START.go(<span class="string">'tell a joke'</span>)</span><br><span class="line">    assert_equal(room, laser_weapon_armory)</span><br></pre></td></tr></table></figure>
<p>你在这部分练习中的任务是完成地图，并且让自动测试可以完整地检查过整个地图。这包括将所有的<code>generic_death</code>对象修正为游戏中实际的失败结尾。让你的代码成功运行起来，并让你的测试越全面越好。后面我们会对地图做一些修改，到时候这些测试将保证修改后的代码还可以正常工作。</p>
<h2 id="会话-session-和用户跟踪"><a href="#会话-session-和用户跟踪" class="headerlink" title="会话(session)和用户跟踪"></a>会话(session)和用户跟踪</h2><p>在你的 web 程序运行的某个位置，你需要追踪一些信息，并将这些信息和用户的浏览器关联起来。在HTTP协议的框架中，web环境是“无状态(stateless)”的，这意味着你的每一次请求都是独立于其他请求的。如果你请求了页面A，输入了一些数据，然后点了一个页面B的链接，那你在页面A输入的数据就全部消失了。</p>
<p>解决这个问题的方法是为 web 程序建立一个很小的数据存储功能，给每个浏览器进程赋予一个独一无二的数字，用来跟踪浏览器所作的事情。这个存储通常用数据库或者存储在磁盘上的文件来实现。这就是所谓的“会话跟踪”和在浏览器中使用Cookies以保持用户状态。在<code>lpthw.web</code>这个小框架中实现这样的功能是很容易的，以下就是一个这样的例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> web</span><br><span class="line"></span><br><span class="line">web.config.debug = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">    <span class="string">"/count"</span>, <span class="string">"count"</span>,</span><br><span class="line">    <span class="string">"/reset"</span>, <span class="string">"reset"</span></span><br><span class="line">)</span><br><span class="line">app = web.application(urls, locals())</span><br><span class="line">store = web.session.DiskStore(<span class="string">'sessions'</span>)</span><br><span class="line">session = web.session.Session(app, store, initializer=&#123;<span class="string">'count'</span>: <span class="number">0</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">count</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        session.count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> str(session.count)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">reset</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        session.kill()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure>
<p>为了实现这个功能，你需要创建一个<code>sessions/</code>文件夹作为程序的会话存储位置，创建好以后运行这个程序，然后检查<code>/count</code>页面，刷新一下这个页面，看计数会不会累加上去。关掉浏览器后，程序就会“忘掉”之前的位置，这也是我们的游戏所需的功能。有一种方法可以让浏览器永远记住一些信息，不过这会让测试和开发变得更难。如果你回到<code>/reset/</code>页面，然后再访问<code>/count</code> 页面，你可以看到你的计数器被重置了，因为你已经把会话杀掉了。</p>
<p>你需要花点时间弄懂这段代码，注意会话开始时 <code>count</code>的值是如何设为 0 的。另外再看看 <code>sessions/</code>下面的文件，看你能不能把它们打开。下面是我把一个 Python 会话打开并且解码的过程：</p>
<pre><code>&gt;&gt;&gt; import pickle
&gt;&gt;&gt; import base64
&gt;&gt;&gt; base64.b64decode(open(&quot;sessions/XXXXX&quot;).read())
&quot;(dp1\nS&apos;count&apos;\np2\nI1\nsS&apos;ip&apos;\np3\nV127.0.0.1\np4\nsS&apos;session_id&apos;\np5\nS&apos;XXXX&apos;\np6\ns.&quot;
&gt;&gt;&gt;
&gt;&gt;&gt; x = base64.b64decode(open(&quot;sessions/XXXXX&quot;).read())
&gt;&gt;&gt;
&gt;&gt;&gt; pickle.loads(x)
{&apos;count&apos;: 1, &apos;ip&apos;: u&apos;127.0.0.1&apos;, &apos;session_id&apos;: &apos;XXXXX&apos;}
</code></pre><p>所以会话其实就是使用<code>pickle</code>和<code>base64</code>这些库写到磁盘上的字典。存储和管理会话的方法很多，大概和 Python 的 web 框架那么多，所以了解它们的工作原理并不重要。当然如果你需要调试或者清空会话时，知道点原理还是有用的。</p>
<h2 id="创建引擎"><a href="#创建引擎" class="headerlink" title="创建引擎"></a>创建引擎</h2><p>你应该已经写好了游戏地图和它的单元测试代码。现在我要求你制作一个简单的游戏引擎，用来让游戏中的各个房间运转起来，从玩家收集输入，并且记住玩家到了那一幕。我们将用到你刚学过的会话来制作一个简单的引擎，让它可以：</p>
<blockquote>
<ol>
<li>为新用户启动新的游戏。</li>
<li>将房间展示给用户。</li>
<li>接受用户的输入。</li>
<li>在游戏中处理用户的输入。</li>
<li>显示游戏的结果，继续游戏的下一幕，知道玩家角色死亡为止.</li>
</ol>
</blockquote>
<p>为了创建这个引擎，你需要将我们久经考验的<code>bin/app.py</code>搬过来，创建一个功能完备的、基于会话的游戏引擎。这里的难点是我会先使用基本的 HTML 文件创建一个非常简单的版本，接下来将由你完成它，基本的引擎是这个样子的：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">from</span> gothonweb <span class="keyword">import</span> map</span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">  <span class="string">'/game'</span>, <span class="string">'GameEngine'</span>,</span><br><span class="line">  <span class="string">'/'</span>, <span class="string">'Index'</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app = web.application(urls, globals())</span><br><span class="line"></span><br><span class="line"><span class="comment"># little hack so that debug mode works with sessions</span></span><br><span class="line"><span class="keyword">if</span> web.config.get(<span class="string">'_session'</span>) <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">    store = web.session.DiskStore(<span class="string">'sessions'</span>)</span><br><span class="line">    session = web.session.Session(app, store,</span><br><span class="line">                                  initializer=&#123;<span class="string">'room'</span>: <span class="keyword">None</span>&#125;)</span><br><span class="line">    web.config._session = session</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    session = web.config._session</span><br><span class="line"></span><br><span class="line">render = web.template.render(<span class="string">'templates/'</span>, base=<span class="string">"layout"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># this is used to "setup" the session with starting values</span></span><br><span class="line">        session.room = map.START</span><br><span class="line">        web.seeother(<span class="string">"/game"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GameEngine</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> session.room:</span><br><span class="line">            <span class="keyword">return</span> render.show_room(room=session.room)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># why is there here? do you need it?</span></span><br><span class="line">            <span class="keyword">return</span> render.you_died()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">POST</span><span class="params">(self)</span>:</span></span><br><span class="line">        form = web.input(action=<span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># there is a bug here, can you fix it?</span></span><br><span class="line">        <span class="keyword">if</span> session.room <span class="keyword">and</span> form.action:</span><br><span class="line">            session.room = session.room.go(form.action)</span><br><span class="line"></span><br><span class="line">        web.seeother(<span class="string">"/game"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app.run()</span><br></pre></td></tr></table></figure></p>
<p>这个脚本里你可以看到更多的新东西，不过了不起的事情是，整个基于网页的游戏引擎只要一个小文件就可以做到了。这段脚本里最有技术含量的事情就是将会话带回来的那几行，这对于调试模式下的代码重载是必须的，否则每次你刷新网页，会话就会消失，游戏也不会再继续了。</p>
<p>在你运行<code>bin/app.py</code>之前，你需要修改<code>PYTHONPATH</code>环境变量。不知道什么是环境变量？为了运行一个最基本的 Python 程序，你就得学会环境变量，Python 的这一点确实有点挫。不过没办法，用 Python 的人就喜欢这样：<br>在你的命令行终端，输入:</p>
<pre><code>export PYTHONPATH=$PYTHONPATH:.
</code></pre><p>如果你用的是 Windows，那就输入:</p>
<pre><code>$env:PYTHONPATH = &quot;$env:PYTHONPATH;.&quot;
</code></pre><p>你只要针对每一个命令行会话界面输入一次就可以了，不过如果你运行 Python 代码时看到了import错误，那你就需要去执行一下上面的命令，或者也许是因为你上次执行的 有错才导致 import 错误的。</p>
<p>接下来你需要删掉<code>templates/hello_form.html</code>和 <code>templates/index.html</code>，然后重新创建上面代码中提到的两个模板。这里是一个非常简单的 <code>templates/show_room.html</code> 供你参考：</p>
<pre><code>$def with (room)

&lt;h1&gt; $room.name &lt;/h1&gt;

&lt;pre&gt;
$room.description
&lt;/pre&gt;

$if room.name == &quot;death&quot;:
    &lt;p&gt;&lt;a href=&quot;/&quot;&gt;Play Again?&lt;/a&gt;&lt;/p&gt;
$else:
    &lt;p&gt;
    &lt;form action=&quot;/game&quot; method=&quot;POST&quot;&gt;
        - &lt;input type=&quot;text&quot; name=&quot;action&quot;&gt; &lt;input type=&quot;SUBMIT&quot;&gt;
    &lt;/form&gt;
    &lt;/p&gt;
</code></pre><p>这就用来显示游戏中的房间的模板。接下来，你需要在用户跑到地图的边界时，用一个 模板告诉用户他的角色的死亡信息，也就是 <code>templates/you_died.html</code> 这个模板：</p>
<pre><code>&lt;h1&gt;You Died!&lt;/h1&gt;

&lt;p&gt;Looks like you bit the dust.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;/&quot;&gt;Play Again&lt;/a&gt;&lt;/p&gt;
</code></pre><p>准备好了这些文件，你现在可以做下面的事情了：</p>
<blockquote>
<ol>
<li>让测试代码 <code>tests/app_tests.py</code> 再次运行起来，这样你就可以去测试这个游戏。由于会话的存在，你可能顶多只能实现几次点击，不过你应该可以做出一些基本的测试来。</li>
<li>删除 <code>sessions/*</code>下的文件，再重新运行一遍游戏，确认游戏是从一开始运行起来的。</li>
<li>执行 <code>python bin/app.py</code> 脚本，试玩一下你的游戏。</li>
</ol>
</blockquote>
<p>你需要和往常一样刷新和修正你的游戏，慢慢修改游戏的 HTML 文件和引擎，直到你实现游戏需要的所有功能为止。</p>
<h2 id="你的期末考试"><a href="#你的期末考试" class="headerlink" title="你的期末考试"></a>你的期末考试</h2><p>你有没有觉着我一下子给了你超多的信息呢？那就对了，我想要你在学习技能的同时可以有一些可以用来鼓捣的东西。为了完成这节习题，我将给你最后一套需要你自己完成的练习。你将注意到，到目前为止你写的游戏并不是很好，这只是你的第一版代码而已。你现在的任务是通过做这些事让游戏更加完善：</p>
<blockquote>
<ol>
<li>修正代码中所有我提到和没提到的 bug，如果你发现了新的 bug，你可以告诉我。</li>
<li>改进所有的自动测试，让你可以测试更多的内容，直到你可以不用浏览器就能测到所有的内容为止。</li>
<li>让 HTML 页面看上去更美观一些。</li>
<li>研究一下网页登录系统，为这个程序创建一个登录界面，这样人们就可以登录这个游戏，并且可以保存游戏高分。</li>
<li>完成游戏地图，尽可能地把游戏做大，功能做全。</li>
<li>给用户一个“帮助系统”，让他们可以查询每个房间里可以执行哪些命令。</li>
<li>为你的游戏添加新功能，想到什么功能就添加什么功能。</li>
<li>创建多个地图，让用户可以选择他们想要玩的一张来进行游戏。你的 <code>bin/app.py</code> 应该可以运行提供给它的任意的地图，这样你的引擎就可以支持多个不同的游戏。</li>
<li>最后，使用你在习题 48 和 49 中学到的东西来创建一个更好的输入处理器。你手头已经有了大部分必要的代码，你只需要改进语法，让它和你的输入表单以及游戏引擎挂钩即可。</li>
</ol>
</blockquote>
<p>祝你好运！</p>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Q-我在游戏中使用了sessions，但是我没办法利用nosetests来测试它"><a href="#Q-我在游戏中使用了sessions，但是我没办法利用nosetests来测试它" class="headerlink" title="Q: 我在游戏中使用了sessions，但是我没办法利用nosetests来测试它"></a>Q: 我在游戏中使用了<code>sessions</code>，但是我没办法利用<code>nosetests</code>来测试它</h3><blockquote>
<p>你需要了解sessions的机制。<code>http://webpy.org/cookbook/session_with_reloader</code>。</p>
</blockquote>
<h3 id="Q-我遇到报错ImportError"><a href="#Q-我遇到报错ImportError" class="headerlink" title="Q: 我遇到报错ImportError"></a>Q: 我遇到报错<code>ImportError</code></h3><blockquote>
<p> 错误的目录。 错误的Python版本。 <code>PYTHONPATH</code>没有设置，没有<code>__init__.py</code>文件，检查<code>import</code>中的拼写错误。</p>
</blockquote>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/12/05/learn-python-the-hard-way-Advice_From_An_Old_Programmer/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          笨办法学Python--来自老程序员的建议
        
      </div>
    </a>
  
  
    <a href="/2014/12/03/learn-python-the-hard-way-exercise51/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">笨办法学Python--exercise51.从浏览器获取输入</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="learn-python-the-hard-way-exercise52" data-title="笨办法学Python--exercise52.开始你的web游戏" data-url="http://coofee.me/2014/12/04/learn-python-the-hard-way-exercise52/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"flyouting"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 flyouting and shirley
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>