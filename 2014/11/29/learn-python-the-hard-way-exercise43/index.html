<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>笨办法学Python--exercise43.基本的面向对象的分析和设计 | flyouting and shirley</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="在这节练习，我想给你介绍一个使用python创建某类东西的过程，也就是“面向对象编程”（OOP）。我把它叫做一个过程，是因为我将给出一系列按顺序进行的步骤，但是你也不应该死板的遵循这个步骤，企图用它解决所有难题。它们对于许多编程问题只是一个良好的开头，而不应该被认为是解决这些问题的唯一方法。这个过程只是一个你可以遵循的方法：


写出或画出你的问题
从1中提炼关键问题并搜索相关资料
为2中的问题创">
<meta property="og:type" content="article">
<meta property="og:title" content="笨办法学Python--exercise43.基本的面向对象的分析和设计">
<meta property="og:url" content="http://coofee.me/2014/11/29/learn-python-the-hard-way-exercise43/index.html">
<meta property="og:site_name" content="flyouting and shirley">
<meta property="og:description" content="在这节练习，我想给你介绍一个使用python创建某类东西的过程，也就是“面向对象编程”（OOP）。我把它叫做一个过程，是因为我将给出一系列按顺序进行的步骤，但是你也不应该死板的遵循这个步骤，企图用它解决所有难题。它们对于许多编程问题只是一个良好的开头，而不应该被认为是解决这些问题的唯一方法。这个过程只是一个你可以遵循的方法：


写出或画出你的问题
从1中提炼关键问题并搜索相关资料
为2中的问题创">
<meta property="og:updated_time" content="2014-12-07T15:15:54.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="笨办法学Python--exercise43.基本的面向对象的分析和设计">
<meta name="twitter:description" content="在这节练习，我想给你介绍一个使用python创建某类东西的过程，也就是“面向对象编程”（OOP）。我把它叫做一个过程，是因为我将给出一系列按顺序进行的步骤，但是你也不应该死板的遵循这个步骤，企图用它解决所有难题。它们对于许多编程问题只是一个良好的开头，而不应该被认为是解决这些问题的唯一方法。这个过程只是一个你可以遵循的方法：


写出或画出你的问题
从1中提炼关键问题并搜索相关资料
为2中的问题创">
  
    <link rel="alternative" href="/atom.xml" title="flyouting and shirley" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ww2.sinaimg.cn/small/4a242739gw1eu09kkcr5xj2050050glt.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">flyouting and shirley</a></h1>
		</hgroup>

		
		<p class="header-subtitle">记录一点一滴</p>
		

		<!--
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		-->

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">首页</a></li>
				        
							<li><a href="/archives">文章列表</a></li>
				        
							<li><a href="/about">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/flyouting" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/flyouting" title="weibo">weibo</a>
					        
								<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/flyouting" title="zhihu">zhihu</a>
					        
								<a class="mail" target="_blank" href="mailto:flyouting@gmail.com" title="mail">mail</a>
					        
						</div>
					</nav>
				</section>
				
				<!--<div class="switch-part switch-part2"><script>var n ='b-26003349-pe-f-801';var ch ='pc_6'; var w1 = 200;var h1 = 280;</script> <script src='http://static.luna.58.com/js/mad.js'></script></div>
				-->
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/AndroidStudio/" style="font-size: 10px;">AndroidStudio</a> <a href="/tags/DB/" style="font-size: 12.5px;">DB</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/ImageSpan/" style="font-size: 10px;">ImageSpan</a> <a href="/tags/ORM/" style="font-size: 12.5px;">ORM</a> <a href="/tags/Python/" style="font-size: 12.5px;">Python</a> <a href="/tags/activeandroid/" style="font-size: 10px;">activeandroid</a> <a href="/tags/android/" style="font-size: 17.5px;">android</a> <a href="/tags/intent/" style="font-size: 10px;">intent</a> <a href="/tags/key/" style="font-size: 10px;">key</a> <a href="/tags/layout/" style="font-size: 10px;">layout</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/span/" style="font-size: 10px;">span</a> <a href="/tags/transitions/" style="font-size: 10px;">transitions</a> <a href="/tags/volley/" style="font-size: 15px;">volley</a> <a href="/tags/webview/" style="font-size: 10px;">webview</a> <a href="/tags/后台，多线程/" style="font-size: 10px;">后台，多线程</a> <a href="/tags/相机/" style="font-size: 15px;">相机</a> <a href="/tags/终端/" style="font-size: 10px;">终端</a> <a href="/tags/设计模式/" style="font-size: 10px;">设计模式</a> <a href="/tags/面试/" style="font-size: 10px;">面试</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">flyouting and shirley</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://ww2.sinaimg.cn/small/4a242739gw1eu09kkcr5xj2050050glt.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">flyouting and shirley</h1>
			</hgroup>
			
			<p class="header-subtitle">记录一点一滴</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">首页</a></li>
		        
					<li><a href="/archives">文章列表</a></li>
		        
					<li><a href="/about">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/flyouting" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/flyouting" title="weibo">weibo</a>
			        
						<a class="zhihu" target="_blank" href="http://www.zhihu.com/people/flyouting" title="zhihu">zhihu</a>
			        
						<a class="mail" target="_blank" href="mailto:flyouting@gmail.com" title="mail">mail</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap"><article id="post-learn-python-the-hard-way-exercise43" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2014/11/29/learn-python-the-hard-way-exercise43/" class="article-date">
  	<time datetime="2014-11-29T14:11:18.000Z" itemprop="datePublished">2014-11-29</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      笨办法学Python--exercise43.基本的面向对象的分析和设计
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python/">python</a></li></ul>
	</div>

        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/Python/">Python</a>
	</div>


        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在这节练习，我想给你介绍一个使用python创建某类东西的过程，也就是“面向对象编程”（OOP）。我把它叫做一个过程，是因为我将给出一系列按顺序进行的步骤，但是你也不应该死板的遵循这个步骤，企图用它解决所有难题。它们对于许多编程问题只是一个良好的开头，而不应该被认为是解决这些问题的唯一方法。这个过程只是一个你可以遵循的方法：</p>
<blockquote>
<ol>
<li>写出或画出你的问题</li>
<li>从1中提炼关键问题并搜索相关资料</li>
<li>为2中的问题创建一个有层次结构的类和对象映射 </li>
<li>编写类和测试代码，并保证他们运行</li>
<li>重复并精炼</li>
</ol>
</blockquote>
<p>按照这个顺序执行流程，叫做“自顶向下”的方式，意思是说，它从非常抽象宽松的想法开始，然后慢慢提炼，直到想法是坚实的东西，然后你再开始编码。</p>
<p>首先我只是写出这个问题，并试图想出任何我想要的东西就可以了。也许我会画一两个图表，或者某种可能的地图，甚至给自己写了一系列的电子邮件描述这个问题。这给了我表达了问题的关键概念的方法，并探测出我对于这个游戏有什么具体的想法和了解。</p>
<p>接下来，我浏览这些笔记，图表以及描述，通过这些记录我找到我需要的关键问题点。有一个简单的技巧：简单地列出你的笔记和图表中所有的名词和动词,然后写出他们是如何相关的。这一步其实也我为我下一步要写的类、对象、以及函数等提供了命名列表。我利用这个概念列表，研究任何我不明白的地方，如果我需要，我还可以进一步完善它们。</p>
<p>一旦我完成这个列表，我可以创建的一个简单的轮廓/树用来说明这些概念之间的关系。你还可以对着你的名词列表并询问“这个名词和其他的是一个概念吗？或者它们有一个通用的父类吗，那它们的父类是什么？”持续检查，直到你得到一个有层次结构的类，它应该像一棵简单的树或者图表。然后检查你的动词列表，看它们是否可以作为函数的名字添加到你的类树种。</p>
<p>随着这棵类树的生成，我坐下来写一些基本的框架代码，代码中只包括刚才提到的类，类中包含的函数。然后我再写一个测试用例，用来检验我刚才写的类是正确的。有时候我可能只需要在开始写一段测试代码，但是更多的时候，我需要写一段测试，再写一段代码，再写一段测试…直到整个项目完成。</p>
<p>最后，在我完成更多的工作之前，我周期性的重复和精炼这个流程，是他变得清楚和易于理解。如果我在一个没有预料到的地方被一些概念或问题卡住，我会停下来在这一小部分上投入更大的精力来分析解决，直到我解决了这问题，再继续下去。</p>
<p>这节练习中，我将通过建造一个游戏引擎带大家学习这一流程。</p>
<h2 id="分析一个简单的游戏引擎"><a href="#分析一个简单的游戏引擎" class="headerlink" title="分析一个简单的游戏引擎"></a>分析一个简单的游戏引擎</h2><p>我打算制作一个叫做 “Gothons from Planet Percal #25”的游戏，这个一个小型的太空冒险游戏。</p>
<h3 id="写或画出这个问题"><a href="#写或画出这个问题" class="headerlink" title="写或画出这个问题"></a>写或画出这个问题</h3><p>我为这个游戏写了一小段描述：</p>
<p>“外星人乘坐一个宇宙飞船入侵,我们的英雄需要通过一个迷宫似的房间击败他们,然后他才能逃入一个逃生舱到达下面的行星。游戏将更像一个有着文本输出和有趣的死法的Zork或冒险类型游戏。游戏将包括一个引擎运行充满房间或场景的地图。 当玩家进入房间，每个房间将打印自己的描述,然后告诉引擎运行下一个地图。”</p>
<p>我先描述每个场景：</p>
<p>Death<br>:   这是玩家死亡的场景，应该是有趣的。</p>
<p>Central Corridor<br>:   这是游戏的起点，在这里已经有一个外星人等待英雄的到来，它们需要被一个玩笑打败。</p>
<p>Laser Weapon Armory<br>:   这是英雄得到了中子弹获得的逃生舱之前要炸毁的船。它有一个需要英雄猜数的键盘。</p>
<p>The Bridge<br>:   和外星人战斗的另一个场景，英雄防止炸弹的地方。</p>
<p>Escape Pod<br>:   英雄逃脱的场景，但是需要英雄找对正确的逃生舱</p>
<p>现在，我可以绘制出它们的地图，或者对每个房间再多写一些描述，或者其他一些我脑中出现的想法。</p>
<h3 id="提取关键概念并研究他们"><a href="#提取关键概念并研究他们" class="headerlink" title="提取关键概念并研究他们"></a>提取关键概念并研究他们</h3><p>现在我已经有足够多的信息还提取出名词，并分析它们的类结构。首先我列出所有的名词：</p>
<blockquote>
<ul>
<li>Alien</li>
<li>Player</li>
<li>Ship</li>
<li>Maze</li>
<li>Room</li>
<li>Scene</li>
<li>Gothon</li>
<li>Escape Pod</li>
<li>Planet</li>
<li>Map</li>
<li>Engine</li>
<li>Death</li>
<li>Central Corridor</li>
<li>Laser Weapon Armory</li>
<li>The Bridge</li>
</ul>
</blockquote>
<p>我也可能要列出所有的动词，看它们能否作为函数的名字，不过现在我要先跳过这一步。</p>
<p>你需要研究所有你现在还不知道的概念。例如，我可能会玩几个这种类型的游戏，并确保知道他们是如何工作的。我可能会研究船舶和炸弹的设计和工作原理。也许我会研究怎么样将游戏中的数据或状态存储在数据库等一些技术上的问题。我做完这个研究之后，我可能会回到第1步重新开始，根据新的信息，重写描述和提取新的概念。</p>
<h3 id="创建一个层次结构的类和对象映射的概念"><a href="#创建一个层次结构的类和对象映射的概念" class="headerlink" title="创建一个层次结构的类和对象映射的概念"></a>创建一个层次结构的类和对象映射的概念</h3><p>当我完成上面的步骤，我通过思考“哪些是类似于其他东西的”，把名词列表转换成一个有层次结构的类树，同样，我也会思考，哪些单词是其他东西的基础呢？</p>
<p>马上我发现，”Room” 和 “Scene”对于我要做的事情来说基本上是一样的事情。在这个游戏中，我选择使用”Scene” 。接下来我发现，所有的特殊房间比如”Central Corridor”基本上也跟”Scene”是一样的。我发现”Death”也是一个”Scene”, 由于我选择了”Scene”而不是”Room”，你可以有一个“死亡场景”，而是不一个很奇怪的“死亡房间”。”Maze”和”Map”基本一样，所以我选择使用”Map”，因为我更多的时候都用它。我不想做一个战斗系统，所以我会先忽略”Alien”和 “Player”，但是会把他们保存下来以供以后使用。”Planet”也可能仅仅是另一个场景，而不是什么具体的事情。</p>
<p>在此之后，我开始创建一个层次结构的类：</p>
<blockquote>
<ul>
<li>Map</li>
<li>Engine</li>
<li>Scene<ul>
<li>Death</li>
<li>Central Corridor</li>
<li>Laser Weapon Armory</li>
<li>The Bridge</li>
<li>Escape Pod</li>
</ul>
</li>
</ul>
</blockquote>
<p>然后，我会找出说明中每个动词都需要什么行动。比如，我从说明中得知，我需要一个方法来”run”这个引擎，通过地图获得下一个场景”get the next scene”，获得”opening scene”，或者”enter”一个场景。我把这些加到类树里：</p>
<blockquote>
<ul>
<li>Map<br>- next_scene<br>- opening_scene</li>
<li>Engine<br>- play</li>
<li>Scene<br>- enter<br>* Death<br>* Central Corridor<br>* Laser Weapon Armory<br>* The Bridge<br>* Escape Pod</li>
</ul>
</blockquote>
<p>注意一下，我只是把<code>-enter</code>放到<code>Scene</code>下面，因为我知道所有的场景都会继承它并重写它。</p>
<h3 id="编码类和测试代码并运行它们"><a href="#编码类和测试代码并运行它们" class="headerlink" title="编码类和测试代码并运行它们"></a>编码类和测试代码并运行它们</h3><p>当我有了这个类树和一些功能之后，我在编辑器中打开源文件，并尝试编写代码。通常，我会复制粘贴这棵类树到源文件中，然后编辑它。下面是一个如何编码的小例子，文件末尾包含一个简单的测试用例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scene</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engine</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, scene_map)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Death</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CentralCorridor</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LaserWeaponArmory</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TheBridge</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EscapePod</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Map</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start_scene)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_scene</span><span class="params">(self, scene_name)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">opening_scene</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a_map = Map(<span class="string">'central_corridor'</span>)</span><br><span class="line">a_game = Engine(a_map)</span><br><span class="line">a_game.play()</span><br></pre></td></tr></table></figure>
<p>在这个文件中，你可以看到我只是复制了我想要的层次结构,然后一点点的补齐代码再运行它,看看它在这个基本结构中是否运行顺利。 在这节练习后面的部分，你会填补这段代码的其余部分，使其正常工作，以配合练习开头的游戏描述。</p>
<h3 id="重复并精炼"><a href="#重复并精炼" class="headerlink" title="重复并精炼"></a>重复并精炼</h3><p>在我提供的流程中，最后一步并不是实际意义上的一步，而是要做一个循环。在编程的世界里，你永远做不到一次通过，相反，你退回整个过程，并再次根据你从后面的步骤中了解到的信息完善它。有时候我已经到了第3步，但是我发现我还需要在第1、2步做更多工作，我会停下来并返回去完善它。有时候我也会突然灵光一闪，跳到最后，用我脑子里更好的解决方案编码实现，但是之后，我仍然会回去完成前面的步骤，以确保我的工作覆盖了所有的可能性。</p>
<p>在这一过程的另一个观点是，你不是仅在一个层面上使用这个流程，当你遇到某些特定问题的时候，你可以在任意一个层级上使用该流程。比方说，我不知道如何写<code>Engine.play</code>方法，我可以静下心来用这个流程只做这一种功能，直到弄清楚这个方法怎么写。</p>
<h2 id="自顶向下和自下而上"><a href="#自顶向下和自下而上" class="headerlink" title="自顶向下和自下而上"></a>自顶向下和自下而上</h2><p>因为这个流程在最抽象的概念（顶部）开始，然后再下降到实际执行过程中，因此这一流程通常标示为“自上而下”。我希望你使用这一流程，但你也应该知道，还有另一种方式来解决程序中的问题，这种方式是从代码开始，再“上升”到抽象的概念问题。这种方式被称为“自下而上”。下面是自下而下方式所遵循的步骤：</p>
<blockquote>
<ol>
<li>取一小块问题，编写一些代码，并让他勉强运行</li>
<li>完善代码，将其转换成一些更正式的包含类和自动化测试的代码。</li>
<li>提取其中的关键概念，并尝试找出研究他们。</li>
<li>写出到底发生了什么的描述。</li>
<li>继续完善代码，也可能是把它扔掉，并重新开始。</li>
<li>移动到其他问题上，重复步骤。</li>
</ol>
</blockquote>
<p>当你需要更优质的代码，并在代码中更自然的思考你要解决的问题时，这种方式更好一些。尤其是当你知道小块的难题,但没有足够的信息把握整个概念的时候，这个方式是一个解决问题很好的办法。将问题分解成碎片并探索代码,直到你解决这个问题。然而，你解决问题的途径可能是缓慢而曲折的，所以，我的这一流程中也包含后退并反复研究问题，直到你通过自己所为解决所有难题。</p>
<h2 id="“来自-Percal-25-号行星的哥顿人”的代码"><a href="#“来自-Percal-25-号行星的哥顿人”的代码" class="headerlink" title="“来自 Percal 25 号行星的哥顿人”的代码"></a>“来自 Percal 25 号行星的哥顿人”的代码</h2><p>我要告诉你我解决上述问题的最终办法,但我不希望你只是直接跳到这里并输入代码。我希望你能通过我的描述，完成我写的那个简单粗糙的代码框架，并让他运行起来。当你有了自己的解决方案时，你可以回来看看我是怎么解决的。</p>
<p>我准备把文件<code>ex43.py</code>拆成小块，再一一解释，而不是一次性提供完整的代码。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br></pre></td></tr></table></figure></p>
<p>这只是我们游戏需要导入的包，没什么新奇的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scene</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"This scene is not yet configured. Subclass it and implement enter()."</span></span><br><span class="line">        exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>正如你在框架代码里看到的，我创建了基础类<code>Scene</code>,它将包含所有scene要做的所有的事。在这段代码中，它们并没有做什么，所以这只是给你的一个如果创建基类的示范。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engine</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, scene_map)</span>:</span></span><br><span class="line">        self.scene_map = scene_map</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">play</span><span class="params">(self)</span>:</span></span><br><span class="line">        current_scene = self.scene_map.opening_scene()</span><br><span class="line">        last_scene = self.scene_map.next_scene(<span class="string">'finished'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> current_scene != last_scene:</span><br><span class="line">            next_scene_name = current_scene.enter()</span><br><span class="line">            current_scene = self.scene_map.next_scene(next_scene_name)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># be sure to print out the last scene</span></span><br><span class="line">        current_scene.enter()</span><br></pre></td></tr></table></figure>
<p>我同样创建了类<code>Engine</code>，并且你能看到我已经使用了方法<code>Map.opening_scene</code> 和 <code>Map.next_scene</code>。因为在我写<code>Map</code>类之前，做了一点计划，我可以假设我后面会写这些,然后提前使用它们。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Death</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    quips = [</span><br><span class="line">        <span class="string">"You died.  You kinda suck at this."</span>,</span><br><span class="line">         <span class="string">"Your mom would be proud...if she were smarter."</span>,</span><br><span class="line">         <span class="string">"Such a luser."</span>,</span><br><span class="line">         <span class="string">"I have a small puppy that's better at this."</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> Death.quips[randint(<span class="number">0</span>, len(self.quips)<span class="number">-1</span>)]</span><br><span class="line">        exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>我的第一个场景是一个叫做<code>Death</code>的场景，它给你展现了你能写的最简单的场景。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CentralCorridor</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"The Gothons of Planet Percal #25 have invaded your ship and destroyed"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"your entire crew.  You are the last surviving member and your last"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"mission is to get the neutron destruct bomb from the Weapons Armory,"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"put it in the bridge, and blow the ship up after getting into an "</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"escape pod."</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"\n"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"You're running down the central corridor to the Weapons Armory when"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"a Gothon jumps out, red scaly skin, dark grimy teeth, and evil clown costume"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"flowing around his hate filled body.  He's blocking the door to the"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Armory and about to pull a weapon to blast you."</span></span><br><span class="line"></span><br><span class="line">        action = raw_input(<span class="string">"&gt; "</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"shoot!"</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Quick on the draw you yank out your blaster and fire it at the Gothon."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"His clown costume is flowing and moving around his body, which throws"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"off your aim.  Your laser hits his costume but misses him entirely.  This"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"completely ruins his brand new costume his mother bought him, which"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"makes him fly into an insane rage and blast you repeatedly in the face until"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"you are dead.  Then he eats you."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'death'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">"dodge!"</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Like a world class boxer you dodge, weave, slip and slide right"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"as the Gothon's blaster cranks a laser past your head."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"In the middle of your artful dodge your foot slips and you"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"bang your head on the metal wall and pass out."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You wake up shortly after only to die as the Gothon stomps on"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"your head and eats you."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'death'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">"tell a joke"</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Lucky for you they made you learn Gothon insults in the academy."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You tell the one Gothon joke you know:"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Lbhe zbgure vf fb sng, jura fur fvgf nebhaq gur ubhfr, fur fvgf nebhaq gur ubhfr."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"The Gothon stops, tries not to laugh, then busts out laughing and can't move."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"While he's laughing you run up and shoot him square in the head"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"putting him down, then jump through the Weapon Armory door."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'laser_weapon_armory'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"DOES NOT COMPUTE!"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'central_corridor'</span></span><br></pre></td></tr></table></figure></p>
<p>接下来，我创建了<code>CentralCorridor</code>，这是游戏的开始。我在写<code>Map</code>之前，为游戏制作了这个场景，是因为我后面要引用它们。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LaserWeaponArmory</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"You do a dive roll into the Weapon Armory, crouch and scan the room"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"for more Gothons that might be hiding.  It's dead quiet, too quiet."</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"You stand up and run to the far side of the room and find the"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"neutron bomb in its container.  There's a keypad lock on the box"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"and you need the code to get the bomb out.  If you get the code"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"wrong 10 times then the lock closes forever and you can't"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"get the bomb.  The code is 3 digits."</span></span><br><span class="line">        code = <span class="string">"%d%d%d"</span> % (randint(<span class="number">1</span>,<span class="number">9</span>), randint(<span class="number">1</span>,<span class="number">9</span>), randint(<span class="number">1</span>,<span class="number">9</span>))</span><br><span class="line">        guess = raw_input(<span class="string">"[keypad]&gt; "</span>)</span><br><span class="line">        guesses = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> guess != code <span class="keyword">and</span> guesses &lt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"BZZZZEDDD!"</span></span><br><span class="line">            guesses += <span class="number">1</span></span><br><span class="line">            guess = raw_input(<span class="string">"[keypad]&gt; "</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> guess == code:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"The container clicks open and the seal breaks, letting gas out."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You grab the neutron bomb and run as fast as you can to the"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"bridge where you must place it in the right spot."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'the_bridge'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"The lock buzzes one last time and then you hear a sickening"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"melting sound as the mechanism is fused together."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You decide to sit there, and finally the Gothons blow up the"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"ship from their ship and you die."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'death'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TheBridge</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"You burst onto the Bridge with the netron destruct bomb"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"under your arm and surprise 5 Gothons who are trying to"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"take control of the ship.  Each of them has an even uglier"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"clown costume than the last.  They haven't pulled their"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"weapons out yet, as they see the active bomb under your"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"arm and don't want to set it off."</span></span><br><span class="line"></span><br><span class="line">        action = raw_input(<span class="string">"&gt; "</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> action == <span class="string">"throw the bomb"</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"In a panic you throw the bomb at the group of Gothons"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"and make a leap for the door.  Right as you drop it a"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Gothon shoots you right in the back killing you."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"As you die you see another Gothon frantically try to disarm"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"the bomb. You die knowing they will probably blow up when"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"it goes off."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'death'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> action == <span class="string">"slowly place the bomb"</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You point your blaster at the bomb under your arm"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"and the Gothons put their hands up and start to sweat."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You inch backward to the door, open it, and then carefully"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"place the bomb on the floor, pointing your blaster at it."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You then jump back through the door, punch the close button"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"and blast the lock so the Gothons can't get out."</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Now that the bomb is placed you run to the escape pod to"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"get off this tin can."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'escape_pod'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"DOES NOT COMPUTE!"</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">"the_bridge"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EscapePod</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"You rush through the ship desperately trying to make it to"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"the escape pod before the whole ship explodes.  It seems like"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"hardly any Gothons are on the ship, so your run is clear of"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"interference.  You get to the chamber with the escape pods, and"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"now need to pick one to take.  Some of them could be damaged"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"but you don't have time to look.  There's 5 pods, which one"</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"do you take?"</span></span><br><span class="line"></span><br><span class="line">        good_pod = randint(<span class="number">1</span>,<span class="number">5</span>)</span><br><span class="line">        guess = raw_input(<span class="string">"[pod #]&gt; "</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> int(guess) != good_pod:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You jump into pod %s and hit the eject button."</span> % guess</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"The pod escapes out into the void of space, then"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"implodes as the hull ruptures, crushing your body"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"into jam jelly."</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'death'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"You jump into pod %s and hit the eject button."</span> % guess</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"The pod easily slides out into space heading to"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"the planet below.  As it flies to the planet, you look"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"back and see your ship implode then explode like a"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"bright star, taking out the Gothon ship at the same"</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">"time.  You won!"</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="string">'finished'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Finished</span><span class="params">(Scene)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enter</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"You won! Good job."</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'finished'</span></span><br></pre></td></tr></table></figure></p>
<p>这是游戏剩下的场景。因为我知道我需要他们，并且已经想好他们应该如何交织在一起，所以我可以直接编码。</p>
<p>顺便说一下，我不是直接输入这些代码。记得我说过的吗，用增量的方法尝试构建所有的代码，一次只写一小部分。我只是给你看了最终的结果。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Map</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    scenes = &#123;</span><br><span class="line">        <span class="string">'central_corridor'</span>: CentralCorridor(),</span><br><span class="line">        <span class="string">'laser_weapon_armory'</span>: LaserWeaponArmory(),</span><br><span class="line">        <span class="string">'the_bridge'</span>: TheBridge(),</span><br><span class="line">        <span class="string">'escape_pod'</span>: EscapePod(),</span><br><span class="line">        <span class="string">'death'</span>: Death(),</span><br><span class="line">        <span class="string">'finished'</span>: Finished(),</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, start_scene)</span>:</span></span><br><span class="line">        self.start_scene = start_scene</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_scene</span><span class="params">(self, scene_name)</span>:</span></span><br><span class="line">        val = Map.scenes.get(scene_name)</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">opening_scene</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.next_scene(self.start_scene)</span><br></pre></td></tr></table></figure>
<p>在这之后，我写了<code>Map</code>类，你可以看到它通过名字把所有的场景存在了字典中。我把这个字典叫做<code>Map.scenes</code>。这也是为什么map是在scens之后才写的原因，因为这个字典需要包含所有已存在的场景。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a_map = Map(<span class="string">'central_corridor'</span>)</span><br><span class="line">a_game = Engine(a_map)</span><br><span class="line">a_game.play()</span><br></pre></td></tr></table></figure></p>
<p>最后，我让我的代码通过创建一个<code>Map</code>，并在调用<code>play</code>之前把map交给<code>Engine</code>,把游戏运行起来，</p>
<h2 id="你看到的结果"><a href="#你看到的结果" class="headerlink" title="你看到的结果"></a>你看到的结果</h2><p>确保你明白这个游戏，并且首先尝试自己解决它。如果你被难住了，可以阅读一小部分我的代码，然后再尝试自己搞定它。</p>
<p>当我运行我的游戏的时候，我可以看到：</p>
<pre><code>$ python ex43.py
The Gothons of Planet Percal #25 have invaded your ship and destroyed
your entire crew.  You are the last surviving member and your last
mission is to get the neutron destruct bomb from the Weapons Armory,
put it in the bridge, and blow the ship up after getting into an
escape pod.


You&apos;re running down the central corridor to the Weapons Armory when
a Gothon jumps out, red scaly skin, dark grimy teeth, and evil clown costume
flowing around his hate filled body.  He&apos;s blocking the door to the
Armory and about to pull a weapon to blast you.
&gt;  dodge!
Like a world class boxer you dodge, weave, slip and slide right
as the Gothon&apos;s blaster cranks a laser past your head.
In the middle of your artful dodge your foot slips and you
bang your head on the metal wall and pass out.
You wake up shortly after only to die as the Gothon stomps on
your head and eats you.
Your mom would be proud...if she were smarter.
</code></pre><h2 id="附加题"><a href="#附加题" class="headerlink" title="附加题"></a>附加题</h2><blockquote>
<ol>
<li>修改这个游戏！你可能不喜欢这个游戏。让游戏运行起来，然后按照你的喜好修改它。这是你的电脑，你可以用它做你想做的事情</li>
<li>代码中有一个bug，为什么门锁了11次？</li>
<li>解释一下返回至下一个房间的工作原理。</li>
<li>增加作弊代码，这样你能通过一些更难的房间。我能只在一行上加两个单词做到这些。</li>
<li>回到我的描述和分析，尝试为英雄和他遇见的各种哥顿人创建一个小型作战系统。</li>
<li>这其实是一个小版本的“有限状态机(finite state machine)”，找资料阅读了解一下，虽然你可能看不懂，但还是找来看看吧。</li>
</ol>
</blockquote>
<h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><h3 id="Q-我在哪里可以为我的游戏找到故事情节"><a href="#Q-我在哪里可以为我的游戏找到故事情节" class="headerlink" title="Q: 我在哪里可以为我的游戏找到故事情节"></a>Q: 我在哪里可以为我的游戏找到故事情节</h3><blockquote>
<p>你可以就像给朋友讲述一个故事一样，来创建游戏。或者你可以采取简单的你喜欢的书或电影场景。 </p>
</blockquote>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2014/11/30/learn-python-the-hard-way-exercise44/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          笨办法学Python--exercise44.继承Vs.包含
        
      </div>
    </a>
  
  
    <a href="/2014/11/29/learn-python-the-hard-way-exercise42/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">笨办法学Python--exercise42.对象、类、以及从属关系</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share_jia">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">Share to: &nbsp; </span>
		<a class="jiathis_button_facebook"></a> 
    <a class="jiathis_button_twitter"></a>
    <a class="jiathis_button_plus"></a> 
    <a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
    <a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>






<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="learn-python-the-hard-way-exercise43" data-title="笨办法学Python--exercise43.基本的面向对象的分析和设计" data-url="http://coofee.me/2014/11/29/learn-python-the-hard-way-exercise43/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"flyouting"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 flyouting and shirley
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>